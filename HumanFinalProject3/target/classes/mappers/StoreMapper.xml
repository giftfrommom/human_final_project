<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="storeDAO">

	<select id="getStoreList" resultType="store">
		SELECT *
		  FROM STORE
	  ORDER BY STORE_ID ASC
	</select>
	
	<select id="getStoreTypeList" parameterType="String" resultType="store">
		SELECT *
		  FROM STORE 
		 <if test='_parameter != "all"'>
			WHERE STORE_TYPE=#{value}
		 </if>
	     ORDER BY STORE_ID ASC
	</select>
	
	<select id="getStore" parameterType="Integer" resultType="store">
		SELECT S.STORE_ID, STORE_TYPE, STORE_NAME, MENU_ID, MENU_NAME, MENU_PRICE
	      FROM STORE S, MENU M
		 WHERE S.STORE_ID = M.STORE_ID AND S.STORE_ID=#{value}
	</select>
	
	<select id="getReviewList" parameterType="Integer" resultType="store">
		 SELECT REVIEW_ID, 
				STORE_ID, 
				CUSTOMER_ID,
				REVIEW_CONTENT, 
				REVIEW_RATING_TASTE,
				REVIEW_RATING_AMOUNT,
				REVIEW_RATING_STATE,
				REVIEW_LIKE
		   FROM REVIEW
		  WHERE STORE_ID =#{value}
	</select>
	
	<select id="getBestPlace" parameterType="Integer" resultType="bestplace">
		 SELECT *
		   FROM BESTPLACE
<!-- 		  WHERE STORE_ID =#{value} -->
	</select>
	
	<select id="getStore2" parameterType="ddip" resultType="store">
		SELECT S.STORE_ID, STORE_TYPE, STORE_NAME, MENU_ID, MENU_NAME, MENU_PRICE
		FROM STORE S, MENU M
		WHERE S.STORE_ID = M.STORE_ID 
		AND S.STORE_ID=(SELECT STORE_ID
		                FROM DDIP
		                WHERE DDIP_ID = #{ddip_id})
	</select>
	
	<select id="getCustomerList" parameterType="condition" resultType="customer">
		  SELECT CUSTOMER_ID, CUSTOMER_NAME, CUSTOMER_PREFERMENU, CUSTOMER_PREFERSTORE, CUSTOMER_GENDER, CUSTOMER_BIRTHDAY
		  FROM CUSTOMER
		  WHERE 1=1
		   <if test="gender != null">
			    <choose>
			        <when test="gender == 'male'">
			            AND CUSTOMER_GENDER = '남'
			        </when>
			        <when test="gender == 'female'">
			            AND CUSTOMER_GENDER = '여'
			        </when>
			    </choose>
			</if> 
			<if test="combo1_options != null and combo1_options != 'none'"> -->
		      AND CUSTOMER_PREFERMENU = #{combo1_options}
		    </if>
		    <if test="combo2_options != null and combo2_options != 'none'">
		      AND CUSTOMER_PREFERSTORE = #{combo2_options}
		    </if>
		    <if test="categoryName != null and categoryName != 'none' and search != null">
			  AND ${categoryName} LIKE '%' || #{search} || '%'
			</if>	
			<if test="startDate != null">
		      AND CUSTOMER_BIRTHDAY &gt;= #{startDate}
		    </if>
		    <if test="endDate != null">
		      AND CUSTOMER_BIRTHDAY &lt;= #{endDate}
		    </if>
	</select>
  
	   
	
	
	
</mapper>


